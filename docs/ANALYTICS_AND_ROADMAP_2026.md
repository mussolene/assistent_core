# Аналитика и дорожная карта: минимизация, фокус, интеграции (2026)

Документ фиксирует оценку текущего состояния проекта, тренды, формализованные требования и приоритетную дорожную карту по направлению «минимальный, производительный, полезный ассистент с памятью и связкой с календарём/задачами». **План выполнения: 2026 год** — фазы 0–5 ориентированы на реализацию в течение года.

---

## 1. Честная оценка текущего состояния

### Что получилось и что «странно»

| Аспект | Оценка | Комментарий |
|--------|--------|-------------|
| **Архитектура** | Модульная, но тяжёлая | Много слоёв (оркестратор, шина, агенты, скиллы, дашборд, несколько адаптеров). Для «личного ассистента» избыточно, но даёт гибкость. |
| **Telegram + ИИ + задачи** | Сильная сторона | Связка реально работает: диалог в Telegram, постановка задач, список, выполнение, напоминания. Это ядро продукта. |
| **Доп. возможности** | Работают слабо или неинтересно | /repos, /github, /gitlab зависят от токенов и дашборда; без настройки дают ошибки. Email, Qdrant, индексация репо — много движущихся частей, порог входа высокий. |
| **Уведомления** | Часто «не работают» | Цепочка: MCP/код → `notify_main_channel()` → Redis pub → telegram-adapter → sendMessage. Нужен **Chat ID для MCP** в дашборде (Каналы → Telegram). Если не задан или Redis недоступен из процесса MCP — уведомления не доходят. |
| **Голосовые сообщения** | Нет | Telegram умеет присылать voice; в адаптере нет обработки (конвертация в текст через API или сохранение как файл). Отдельная фича. |
| **Зависимости** | Тяжёлые опции | `sentence-transformers` — большая зависимость для эмбеддингов; Qdrant, файловая индексация (PyPDF, docx, openpyxl, архивы) раздувают образ. Базовый сценарий «чат + задачи» мог бы жить без части из них. |

**Вывод:** Проект не «поделка», а перегруженный по фичам каркас. Имеет смысл **сузить продукт до ядра** (Telegram + ИИ + задачи + память/контекст) и выносить остальное в опциональные модули или отложить.

---

## 2. Тренды (кратко)

- **MCP (Model Context Protocol)** — стандарт «USB-C для ИИ»: один протокол для подключения инструментов и данных. Подключение вашего сервера как MCP даёт любой клиентской ИИ доступ к сценариям и действиям пользователя — тренд 2025–2026.
- **Локальная память и контекст** — тренд на память, независимую от модели (RAG, графы, сжатые контексты), и на снижение размера контекста для малых моделей (adaptive context, MemLoRA и т.п.).
- **Календарь и задачи** — интеграции Google Calendar и Microsoft To-Do через API (OAuth, REST) или через Zapier/n8n типичны; для «ассистента» востребованы сценарии: «создать задачу из сообщения», «записать в календарь», «синхронизировать дедлайны».

---

## 3. Формализованные требования (из запроса)

| ID | Требование | Реалистичность |
|----|------------|----------------|
| R1 | **Минимализм и производительность** — меньше зависимостей, быстрый старт, меньше «лишнего». | Реалистично за счёт профилей сборки и отключения опциональных фич. |
| R2 | **Память, документы, контекст не зависят от модели** — хранить связи, документы, контекст в своём слое (Redis/вектор/БД), модель только «думает» по запросу. | Уже частично есть (short_term, summary, vector, Qdrant). Нужна явная модель «контекст отдельно от модели». |
| R3 | **Полуформализация задач** — из нескольких слов в осознанное описание (название, срок, приоритет). | Реалистично: шаблоны + опциональный вызов LLM для разбора фразы в структуру задачи. |
| R4 | **Связка с Microsoft To-Do и Google Calendar** — задачи уходят в To-Do, события в календарь. | Реалистично: OAuth + REST API обеих платформ; отдельный скилл или сервис. |
| R5 | **Сервер как MCP** — любой ИИ подключается как MCP-клиент и выполняет действия по пользовательским сценариям (задачи, напоминания, уведомления и т.д.). | Уже есть MCP-сервер и инструменты (notify, ask_confirmation, get_user_feedback). Нужно расширить набор инструментов (задачи, календарь) и стабильность. |
| R6 | **Уведомления работают** | Реалистично: явная настройка Chat ID для MCP + проверка цепочки Redis → telegram-adapter. |
| R7 | **Голосовые сообщения** | Средняя сложность: приём voice в Telegram + внешний speech-to-text (локальный или API). Можно отложить. |

---

## 4. Прогноз по фичам и продуктивности

| Направление | Оценка продуктивности | Рекомендация |
|-------------|------------------------|--------------|
| Фокус на Telegram + ИИ + задачи + память | Очень высокая | Делать в первую очередь: это то, что уже «круто работает» и даёт ценность. |
| Полуформализация задач (краткая фраза → структура) | Высокая | Ввести формат «задача = title + optional due + optional priority» и парсер/LLM. |
| Интеграция To-Do + Google Calendar | Высокая | Сильно повышает полезность; один скилл или отдельный сервис с OAuth. |
| MCP как «исполнитель сценариев» | Высокая | Уже есть база; добавить инструменты: create_task, list_tasks, add_calendar_event, sync_to_todo. |
| Исправление уведомлений | Высокая | Низкие трудозатраты: документация + проверка TELEGRAM_DEV_CHAT_ID и подписчика. |
| Минимизация зависимостей | Средняя | Вынести эмбеддинги/Qdrant/индексацию в опциональные extras; «минимальный» образ без sentence-transformers и тяжёлых парсеров. |
| Голосовые сообщения | Средняя | Отложить после ядра и интеграций. |
| Доработка /repos, /github, /gitlab, email | Низкая приоритет | Оставить как есть или упростить; не расширять, пока не закреплено ядро. |

---

## 5. Что стоит начать и что не стоит

### Начинать в первую очередь

1. **Зафиксировать ядро продукта**  
   Официально: «личный ассистент: Telegram + ИИ + задачи + память (и опционально MCP)». Остальное — опциональные модули.

2. **Уведомления**  
   - Документировать настройку (Chat ID для MCP в дашборде).  
   - При первом вызове MCP notify проверять `get_dev_chat_id()` и логировать предупреждение, если не задан.

3. **Полуформализация задач**  
   - Единый формат: title, due_date, priority, notes.  
   - Парсер из короткой фразы (например «завтра купить молоко» → due=завтра, title=купить молоко) через шаблоны или один вызов LLM.

4. **Интеграция с Microsoft To-Do и Google Calendar**  
   - Отдельный скилл или модуль: OAuth, создание задач/событий, опционально двусторонняя синхронизация.  
   - Сценарий: «добавь в календарь встречу завтра в 15:00» / «создай задачу в To-Do».

5. **MCP как исполнитель**  
   - Новые инструменты: `create_task`, `list_tasks`, `add_calendar_event`, `sync_task_to_todo`.  
   - Документация: «как подключить любой ИИ к этому серверу по MCP».

6. **Минимизация зависимостей**  
   - Профиль `minimal`: redis, httpx, openai, pydantic, pyyaml — без sentence-transformers, без pypdf/docx/openpyxl по умолчанию.  
   - Тяжёлые фичи (vector_rag, file_indexing, qdrant) — только при установке соответствующих extras.

### Не стоит (или отложить)

1. **Расширять «всё понемногу»** — не добавлять новые большие фичи (ещё каналы, ещё провайдеры) до закрепления ядра и одной-двух интеграций (To-Do, Calendar).
2. **Голос в первую очередь** — после стабильного ядра и уведомлений.
3. **Усложнять дашборд** — достаточно: настройка бота, модель, MCP, репозитории, пользователи. Не строить универсальный «фронт на всё».

---

## 6. Дорожная карта по этапам (2026)

**Статус выполнения:** Фазы 0–4 и блок 15 (Google Calendar) отражены в [ITERATIONS_ROADMAP.md](ITERATIONS_ROADMAP.md). Прочие доработки (дефолт LM Studio, метрики хоста) — там же.

### Фаза 0: Стабилизация (1–2 недели)

| Задача | Результат |
|--------|-----------|
| Документация уведомлений | В README и в дашборде: как задать Chat ID для MCP; почему уведомления могут не доходить. |
| Проверка цепочки notify | Лог при старте telegram-adapter: подписка на CH_OUTGOING; при пустом get_dev_chat_id — явное предупреждение в логах MCP/дашборда. |
| Профиль зависимостей `minimal` | pyproject.toml: optional `minimal` без sentence-transformers, без files/archives/ocr; core + telegram + tasks работают. |

### Фаза 1: Ядро и полуформализация задач (2–3 недели)

| Задача | Результат |
|--------|-----------|
| Формат задачи и парсер | Единая схема задачи (title, due, priority, notes); функция разбора короткой фразы (шаблоны + опционально LLM). |
| Расширение скилла tasks | При создании задачи из текста — вызов парсера; сохранение в текущее хранилище (Redis) в едином формате. |
| Документ «Ядро продукта» | docs/CORE_PRODUCT.md: что входит в ядро, что опционально, как запустить минимальный контур. |

### Фаза 2: Интеграции календарь и To-Do (3–4 недели)

| Задача | Результат |
|--------|-----------|
| Скилл или сервис «внешние задачи» | Microsoft To-Do API (OAuth): создание задачи, список списков. Google Calendar API (OAuth): создание события. |
| Связка с задачами ассистента | Действие «синхронизировать задачу в To-Do» / «добавить в календарь» из диалога или из MCP. |
| Конфиг в дашборде | Секция (или страница) «Интеграции»: привязка To-Do и Google Calendar (OAuth), хранение токенов в Redis. |

### Фаза 3: MCP как исполнитель сценариев (2–3 недели)

| Задача | Результат |
|--------|-----------|
| MCP-инструменты | `create_task`, `list_tasks`, `add_calendar_event`, `sync_task_to_todo` (при наличии интеграций). |
| Документация MCP | Как подключить Cursor/другой клиент к этому серверу; список инструментов и сценарии (уведомления, задачи, календарь). |
| Стабильность MCP | Обработка ошибок, таймауты, логирование вызовов. |

### Фаза 4: Память и контекст, независимые от модели (2–4 недели)

| Задача | Результат |
|--------|-----------|
| Явная модель контекста | Документ: что хранится где (short_term, summary, vector, задачи); как контекст подмешивается в промпт независимо от выбора модели. |
| Опциональность эмбеддингов | Без sentence-transformers: только short_term + summary + задачи; с optional `vector` — RAG и векторный поиск. |
| Связи «документ — задача — разговор» | При желании: теги или метаданные, чтобы «помнить» связи без обязательного Qdrant. |

### Фаза 5 (опционально): Голос, доработки

| Задача | Результат |
|--------|-----------|
| Голосовые сообщения | Приём voice в Telegram; конвертация в текст (локальный whisper или API); передача текста в оркестратор как обычное сообщение. |
| Доработка второстепенных фич | По остатку времени: улучшение /repos, email, дашборд. |

---

## 7. Минимизация зависимостей (конкретика)

| Группа | Сейчас | Минимальный профиль |
|--------|--------|----------------------|
| Обязательное ядро | redis, httpx, openai, pydantic, pydantic-settings, pyyaml | Без изменений |
| Эмбеддинги | sentence-transformers | Вынести в extra `vector`; без него — без векторного поиска, только short_term + summary + tasks |
| Индексация файлов | pypdf, python-docx, openpyxl, py7zr, rarfile | В extra `files` / `archives`; минимальный образ без них |
| OCR | pytesseract, pillow | В extra `ocr` |
| Дашборд | flask | Оставить в extra `dashboard`; для «только MCP + telegram-adapter» можно не ставить |

**Итог:** «Минимальный» образ = core + telegram + tasks + memory (short_term, summary) + MCP-сервер, без vector_rag, без file_indexing (или заглушка), без дашборда при желании. Максимальная отдача при минимальном наборе — фокус на диалоге, задачах, уведомлениях и одном-двух внешних интеграциях (To-Do, Calendar).

---

## 8. Итоговые тезисы

- **Продолжать развитие стоит**, но с фокусом: **Telegram + ИИ + задачи + память + MCP**, затем интеграции To-Do и Calendar.
- **Странность** — не в идее, а в перегруженности фичами при недоведённом ядре (уведомления, явный «продуктовый» минимум).
- **Реалистичная цель:** супер-минималистичный, производительный ассистент с памятью и контекстом, не привязанными к конкретной модели, с полуформализованными задачами и связкой с To-Do и календарём, доступный любому ИИ по MCP.
- **Начать:** стабилизация уведомлений и минимального профиля, затем полуформализация задач, затем интеграции календарь/To-Do и расширение MCP.

Документ можно использовать как основу для обновления ROADMAP.md и ITERATIONS_ROADMAP.md (новые блоки «Ядро», «Интеграции», «MCP-исполнитель»).
