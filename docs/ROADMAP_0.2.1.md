# Дорожная карта: версия 0.2.1

Цель: **минимализированный, стабильный ассистент** с фокусом на ядре (Telegram + ИИ + задачи + память + MCP), без лишних зависимостей по умолчанию и с исправлением уведомлений. Текущая реализация остаётся под семантической версией **0.1.x**; после релиза v0.1.0 развитие идёт в ветку 0.2.x, первый целевой релиз — **0.2.1**.

Связь с аналитикой: [docs/ANALYTICS_AND_ROADMAP_2025.md](ANALYTICS_AND_ROADMAP_2025.md).

---

## Цели 0.2.1 (кратко)

| Цель | Описание |
|------|----------|
| **Минимальный профиль** | Установка без sentence-transformers и тяжёлых парсеров; core + telegram + tasks + memory (short_term, summary) + MCP. |
| **Уведомления** | Документация настройки Chat ID для MCP; проверка цепочки Redis → telegram-adapter; явное предупреждение при пустом chat_id. |
| **Ядро продукта** | Документ CORE_PRODUCT.md: что входит в ядро, что опционально, как запустить минимальный контур. |
| **Полуформализация задач** | Единый формат задачи (title, due, priority, notes); парсер короткой фразы (шаблоны ± LLM). |
| **Версионирование** | В коде и CI версия 0.2.1 после выполнения плана; CHANGELOG и тег v0.2.1. |

---

## Этапы реализации

### Этап 0.2.1.1: Профиль зависимостей `minimal`

**Цель:** установка `pip install assistant-core[minimal]` или без extras не тянет sentence-transformers и тяжёлые файловые зависимости; ядро + telegram + tasks работают.

| # | Задача | Статус | Файлы / примечания |
|---|--------|--------|---------------------|
| 1 | Вынести `sentence-transformers` в optional `vector` | ✅ | pyproject.toml: убрать из `dependencies`, добавить `[project.optional-dependencies].vector` |
| 2 | Сделать импорт vector_rag/эмбеддингов опциональным | ✅ | В коде: при отсутствии sentence_transformers — заглушка или отключение RAG в memory/skills |
| 3 | Добавить профиль `minimal` в optional-dependencies | ✅ | minimal = только core deps (redis, httpx, openai, pydantic, pydantic-settings, pyyaml); без dashboard, files, archives, ocr, vector |
| 4 | Обновить README: установка minimal vs full | ✅ | Раздел установки: `pip install .` (full) vs `pip install .[minimal]` |
| 5 | Проверить: docker образ или CI с minimal не падает | — | Опционально отдельный Dockerfile.minimal или шаг в CI |

**Критерий приёмки:** `pip install .[minimal]` успешен; запуск assistant-core + telegram-adapter без vector_rag не падает (RAG отключён или заглушка).

---

### Этап 0.2.1.2: Уведомления — документация и диагностика

**Цель:** пользователь понимает, как включить уведомления MCP; при неправильной настройке видит явную причину.

| # | Задача | Статус | Файлы / примечания |
|---|--------|--------|---------------------|
| 1 | Документация: «Chat ID для MCP» в README и в дашборде | ✅ | README: раздел про уведомления / MCP; в дашборде (Каналы → Telegram) подсказка про TELEGRAM_DEV_CHAT_ID |
| 2 | Лог при пустом get_dev_chat_id при вызове notify | ✅ | assistant/core/notify.py: при notify_main_channel() если chat_id нет — logger.warning с текстом «Задайте TELEGRAM_DEV_CHAT_ID или добавьте пользователя в разрешённые» |
| 3 | В дашборде: отображать текущий «Chat ID для уведомлений MCP» (read-only) | ✅ | Чтобы пользователь видел, куда пойдут notify |
| 4 | Проверка подписки на CH_OUTGOING в telegram-adapter при старте | ✅ | Лог при старте: «Subscribed to assistant:outgoing_reply» (или уже есть — проверить) |

**Критерий приёмки:** в README и дашборде есть явная инструкция; при вызове notify без chat_id в логах однозначное предупреждение.

---

### Этап 0.2.1.3: Документ «Ядро продукта»

**Цель:** один документ описывает, что входит в ядро 0.2.x, что опционально, как запустить минимальный контур.

| # | Задача | Статус | Файлы / примечания |
|---|--------|--------|---------------------|
| 1 | Создать docs/CORE_PRODUCT.md | ✅ | Содержание: определение ядра (Telegram, ИИ, задачи, short_term/summary память, MCP); опциональные модули (vector_rag, file_indexing, dashboard, email, Qdrant); команды запуска минимального контура (redis + core + telegram-adapter, опционально MCP) |
| 2 | Ссылка на CORE_PRODUCT из README и ROADMAP | ✅ | Одна строка в README; в ROADMAP.md или ANALYTICS — ссылка |

**Критерий приёмки:** по документу можно понять минимальный набор компонентов и как его собрать.

---

### Этап 0.2.1.4: Полуформализация задач

**Цель:** единая схема задачи и разбор короткой фразы в структуру (title, due, priority, notes).

| # | Задача | Статус | Файлы / примечания |
|---|--------|--------|---------------------|
| 1 | Формат задачи: title, due_date (optional), priority (optional), notes (optional) | ✅ | Либо расширить существующую модель в skills/tasks, либо зафиксировать в памяти/Redis; документ или типы в коде |
| 2 | Парсер короткой фразы → структура (шаблоны: «завтра X», «высокий приоритет X») | ✅ | Функция в core или skills/tasks; без LLM сначала |
| 3 | Опционально: вызов LLM для разбора сложной фразы | — | Если шаблонов недостаточно — один запрос к модели «извлеки title, due, priority из: …» |
| 4 | При создании задачи из текста в диалоге — вызов парсера, сохранение в едином формате | ✅ | Интеграция с текущим tasks skill |

**Критерий приёмки:** из фразы «завтра купить молоко» создаётся задача с due=завтра, title=купить молоко; формат единый во всём приложении.

---

### Этап 0.2.1.5: Версия и релиз 0.2.1

**Цель:** в репозитории и пакете версия 0.2.1; тег и шаблон релиза для GitHub.

| # | Задача | Статус | Файлы / примечания |
|---|--------|--------|---------------------|
| 1 | Bump версии до 0.2.1 в pyproject.toml, assistant/__init__.py, dashboard app/mcp_server (serverInfo) | ⬜ | После выполнения этапов 0.2.1.1–0.2.1.4 |
| 2 | CHANGELOG: секция [0.2.1] с перечислением изменений | ⬜ | minimal profile, уведомления docs/diagnostics, CORE_PRODUCT, полуформализация задач |
| 3 | Шаблон .github/releases/v0.2.1.md для будущего GitHub Release | ⬜ | По аналогии с v0.1.0.md |
| 4 | Тег v0.2.1 и создание Release на GitHub (по желанию после push) | ⬜ | Локально: git tag v0.2.1; push --tags |

**Критерий приёмки:** после мержа ветки версия в коде 0.2.1; CHANGELOG и шаблон релиза готовы.

---

## Порядок выполнения

Рекомендуемая последовательность:

1. **0.2.1.1** — минимальный профиль (сразу снижаем порог входа и размер образа).
2. **0.2.1.2** — уведомления (быстро, высокий эффект).
3. **0.2.1.3** — CORE_PRODUCT (фиксация контракта ядра).
4. **0.2.1.4** — полуформализация задач (улучшение UX ядра).
5. **0.2.1.5** — версия и релиз.

Этапы 0.2.1.1 и 0.2.1.2 можно вести параллельно; 0.2.1.4 может частично пересекаться с 0.2.1.3.

---

## Что не входит в 0.2.1

- Интеграции Microsoft To-Do и Google Calendar — планируются в **0.2.2+** (см. ANALYTICS_AND_ROADMAP_2025.md, Фаза 2).
- Новые MCP-инструменты (create_task, list_tasks, add_calendar_event) — после интеграций, **0.2.2+**.
- Голосовые сообщения — позже (Фаза 5 аналитики).
- Удаление или ломающие изменения существующих фич — только добавление опциональности (minimal) и документов.

---

## Чеклист перед релизом 0.2.1

- [ ] Профиль `minimal` установляется и core + telegram + tasks работают без vector
- [ ] README и дашборд содержат инструкцию по Chat ID для MCP
- [ ] При пустом chat_id в логах явное предупреждение
- [ ] docs/CORE_PRODUCT.md создан и связан из README
- [ ] Парсер задач и единый формат задачи реализованы и задействованы в диалоге
- [ ] Версия 0.2.1 в pyproject.toml и в коде
- [ ] CHANGELOG обновлён, .github/releases/v0.2.1.md подготовлен
- [ ] Регрессия: существующие тесты зелёные, ключевые сценарии проверены вручную
