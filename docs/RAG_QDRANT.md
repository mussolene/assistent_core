# RAG и коллекции Qdrant (итерация 7.2)

## Обзор

Поиск по проиндексированным данным в Qdrant доступен через скилл **search_repos** и опционально через коллекцию документов.

- **vector_rag** — поиск по локальной векторной памяти пользователя (долговременный уровень, sentence-transformers + JSON).
- **search_repos** — RAG-поиск по коллекциям Qdrant: репозитории (index_repo) и/или документы (index_document).

## Коллекции

| Коллекция              | Назначение                    | Скилл/источник индексации |
|------------------------|-------------------------------|---------------------------|
| `repos`                | Проиндексированные репо (index_repo) | index_repo        |
| `documents`            | Проиндексированные файлы (index_document) | index_document |
| `conversation_memory`  | Память разговоров (8.1, 8.2) | Индексация: хук оркестратора. Контекст: выборка по user_id/chat_id и подмешивание в промпт ассистента (search_conversation_memory + filter). |

## Конфигурируемые имена коллекций

Через переменные окружения или Redis (дашборд):

- **QDRANT_REPOS_COLLECTION** — коллекция для поиска по репо (по умолчанию `repos`).
- **QDRANT_DOCUMENTS_COLLECTION** — коллекция для документов (по умолчанию `documents`).

В скилле `search_repos` можно явно передать `collection` в параметрах (например `documents` для поиска по проиндексированным файлам).

## Использование

1. Настроить **QDRANT_URL** (env или дашборд → Репо → Qdrant URL).
2. Проиндексировать репо: `index_repo(repo_dir="/workspace/my_repo")`.
3. Поиск: `search_repos(query="как работает авторизация", top_k=5)` — вернёт релевантные чанки из коллекции `repos`.
4. Поиск по документам: `search_repos(query="...", collection="documents")`.

Память разговоров (conversation memory) — отдельная тема (блок 8); при появлении коллекции для неё можно указывать её имя в `search_repos(collection=...)` или через конфиг.

## Регрессия vector_rag

Скилл **vector_rag** (search, add) не заменён: он по-прежнему работает с локальной векторной памятью пользователя. search_repos дополняет его поиском по Qdrant (репо и документы).
