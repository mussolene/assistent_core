# Требования: задачи (Tasks) — расширенная функциональность

## 1. Список задач в Telegram (API-формат)

- Использовать **список из API Telegram**: сообщение со списком задач и **inline_keyboard**, чтобы пользователь мог взаимодействовать с задачами (галочки, удаление, перенос).
- **Галочка «выполнена»**: под каждой задачей (или в строке) кнопка для отметки выполнения; при нажатии — обновление статуса задачи на `done`, обновление сообщения (редактирование или новое).
- Список можно **удалять** (удалить сообщение со списком) и **переносить** (отправить новое сообщение в нужное место при следующем вызове «список задач»).

## 2. Актуальные и неактуальные задачи

- **Актуальные задачи** — в основном списке только задачи со статусом `open` и с `end_date >= сегодня` (или без даты). Этот список показывается по запросу «список задач» / «мои задачи».
- **Неактуальные** (просроченные, без срока, выполненные) — в **компактном виде**: отдельный блок или сокращённый список (например, «Ещё N задач (выполненные/просроченные)» с кнопкой «Показать» или сразу компактный список).
- При вызове списка задач сообщение с текущим списком можно редактировать или заменять новым (актуальный список).

## 3. Архивация

- По запросу пользователя **«заархивировать выполненные задачи»** — перенос задач со статусом `done` в архив (отдельное хранилище или метка `archived`).
- В основном списке остаются только актуальные (open) задачи; выполненные после архивации не показываются в основном списке.

## 4. Просмотр архива и поиск

- **Просмотр архива**: действие «показать задачи в архиве» / «архив задач» — список заархивированных (выполненных) задач.
- **За период**: фильтр по дате (например, «задачи за февраль», «за последнюю неделю») — по `end_date` или `updated_at`.
- **Поиск по смыслу** с датами: поиск по тексту (title/description) среди задач с фильтром по периоду; результат с датами (дд.мм).

## 5. Подзадачи (субзадачи)

- У задачи могут быть **подзадачи** (связанные дочерние задачи).
- Модель: у задачи поле `parent_id` (опционально); задача с `parent_id` — подзадача родительской.
- Действия: создать подзадачу (`parent_id`), список подзадач по `parent_id`, отображение в списке/детали родителя с вложенным списком подзадач.

## 6. Реализация (кратко)

- **Скилл**: `list_tasks(only_actual=true|false)`, `format_for_telegram(only_actual?, show_done_button?)`, `archive_completed`, `list_archive`, `search_archive(query?, from_date?, to_date?)`, `create_task(parent_id?)`, `list_subtasks(parent_id)`.
- **Telegram**: callback `task:done:{id}` — отметить выполненной; при необходимости `task:archive` — заархивировать выполненные; редактирование сообщения со списком после нажатия.
- **Хранение архива**: отдельный список `assistant:tasks:archive:user:{user_id}` или поле `archived_at` в задаче.

Дорожная карта: блок 10, итерации 10.5–10.9 в `docs/ITERATIONS_ROADMAP.md`.
